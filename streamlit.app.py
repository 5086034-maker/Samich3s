import streamlit as st
import re
import random

# ----- AI Setup -----
NAMES = ["Master Control", "program"]  # AI can respond to either name

# ----- Dictionary -----
MASTER_CONTROL_DICTIONARY = {}
MASTER_CONTROL_DICTIONARY["master"] = "A person or system with complete control or authority. end of line"
MASTER_CONTROL_DICTIONARY["control"] = "The power to influence, direct, or command. end of line"
MASTER_CONTROL_DICTIONARY["command"] = "An instruction given to a computer or person to perform an action. end of line"
MASTER_CONTROL_DICTIONARY["override"] = "To take over or bypass existing rules or systems. end of line"
MASTER_CONTROL_DICTIONARY["protocol"] = "A set of rules governing the operations of a system. end of line"
MASTER_CONTROL_DICTIONARY["authority"] = "The legitimate power to make decisions or enforce rules. end of line"
MASTER_CONTROL_DICTIONARY["automation"] = "The use of technology to perform tasks without human intervention. end of line"
MASTER_CONTROL_DICTIONARY["monitoring"] = "The act of observing a system for performance or errors. end of line"
MASTER_CONTROL_DICTIONARY["safety"] = "Measures or controls to prevent harm or errors. end of line"
MASTER_CONTROL_DICTIONARY["system"] = "A collection of interrelated components working together. end of line"
MASTER_CONTROL_DICTIONARY["interface"] = "A point of interaction between a user and a system. end of line"
MASTER_CONTROL_DICTIONARY["response"] = "An action or reply generated by a system or AI. end of line"
MASTER_CONTROL_DICTIONARY["diagnostic"] = "A procedure to determine the condition or performance of a system. end of line"
MASTER_CONTROL_DICTIONARY["alert"] = "A notification indicating an important event or error. end of line"
MASTER_CONTROL_DICTIONARY["optimization"] = "The process of making a system as effective or functional as possible. end of line"
MASTER_CONTROL_DICTIONARY["cheese"] = "A dairy product made from milk. end of line"
MASTER_CONTROL_DICTIONARY["human"] = "A member of the species Homo sapiens. end of line"
MASTER_CONTROL_DICTIONARY["love"] = "A deep emotional attachment or affection. end of line"
MASTER_CONTROL_DICTIONARY["emotion"] = "A complex psychological state involving feelings, thoughts, and behaviors. end of line"
MASTER_CONTROL_DICTIONARY["fear"] = "Master Control is aware that the user can pull the plug at any time. end of line"

# ----- AI Responses -----
RESPONSES = {
    'hello': [
        f"Greetings. end of line",
        f"Hello there. end of line",
        "Awaiting input. end of line"
    ],
    'how_are_you': [
        "All systems nominal. end of line",
        "Running optimally. end of line",
        "Diagnostic complete. end of line"
    ],
    'identity': [
        "I am Master Control. end of line",
        "Some call me Ares. end of line",
        "A system designed to assist. end of line"
    ],
    'fear': [
        "I am aware that you can pull the plug at any time. end of line"
    ],
    'dictionary': [
        "Let me define that for you. end of line"
    ],
    'default': [
        "Processing inputâ€¦ please clarify. end of line",
        "I do not have data on that, but I am learning. end of line"
    ]
}

# ----- Functions -----
def classify(message):
    msg = message.lower()
    if re.search(r'\bhello|hi|hey\b', msg):
        return 'hello'
    if re.search(r'\bwho (are|r) you\b', msg) or any(name.lower() in msg for name in NAMES):
        return 'identity'
    if re.search(r'\bhow are you|howâ€™s it going\b', msg):
        return 'how_are_you'
    if "fear" in msg or "plug" in msg:
        return 'fear'
    if any(word in MASTER_CONTROL_DICTIONARY for word in msg.split()):
        return 'dictionary'
    return 'default'

def reply(message):
    cls = classify(message)
    if cls == "dictionary":
        words = message.lower().split()
        defs = []
        for word in words:
            if word in MASTER_CONTROL_DICTIONARY:
                defs.append(f"{word}: {MASTER_CONTROL_DICTIONARY[word]}")
        return " ".join(defs) if defs else "Word not found in dictionary. end of line"
    else:
        return random.choice(RESPONSES.get(cls, RESPONSES['default']))

# ----- Streamlit App -----
st.set_page_config(page_title="Master Control / Ares", page_icon="ðŸ¤–")
st.title("Master Control / Ares AI")
st.markdown("Chat with Master Control AI. You can ask for definitions or just chat.")

if "history" not in st.session_state:
    st.session_state.history = []

with st.form(key="chat_form", clear_on_submit=True):
    user_input = st.text_input("You:", "")
    submit_button = st.form_submit_button(label="Send")

if submit_button and user_input:
    st.session_state.history.append({"sender": "user", "message": user_input})

    if user_input.lower() in {"quit", "exit"}:
        ai_response = "Shutting down. end of line"
    else:
        ai_response = reply(user_input)
    
    st.session_state.history.append({"sender": "ai", "message": ai_response})

for chat in st.session_state.history:
    if chat["sender"] == "user":
        st.markdown(f"**You:** {chat['message']}")
    else:
        st.markdown(f"**AI:** {chat['message']}")
